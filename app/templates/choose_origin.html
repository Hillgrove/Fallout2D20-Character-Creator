{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>Create Character</h1>
    <form method="POST" action="{{ url_for('choose_origin') }}">
        {{ form.hidden_tag() }}

        <!-- Name section -->
        <div class="form-group">
            {{ form.name.label(class="form-control-label") }}
            {{ form.name(class="form-control") }}
            {% for error in form.name.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
        </div>

        <!-- Origin section -->
        <div class="form-group">
            {{ form.origin_id.label(class="form-control-label") }}
            {{ form.origin_id(class="form-control", id="origin_id") }}
            {% for error in form.origin_id.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
        </div>

        <!-- Stat section -->
        <div class="form-group">
            <label class="form-control-label">S.P.E.C.I.A.L Stats</label>
            <div id="special_stats">
                <!-- Stats will be dynamically inserted here -->
            </div>
        </div>

        <!-- Background description section -->
        <div class="form-group">
            <label for="origin_description" class="form-control-label">Background Description</label>
            <p id="origin_description" class="form-control-static"></p>
        </div>

        <!-- Trait section -->
        <div class="form-group">
            {{ form.selectable_traits.label(class="form-control-label") }}
            <div id="selectable_traits">
                {% for subfield in form.selectable_traits %}
                    <div class="form-check">
                        {{ subfield(class="form-check-input") }}
                        {{ subfield.label(class="form-check-label") }}
                    </div>
                {% endfor %}
            </div>
            {% for error in form.selectable_traits.errors %}
                <span class="text-danger">{{ error }}</span>
            {% endfor %}
        </div>

        <!-- Next button -->
        <div class="form-group">
            {{ form.submit(class="btn btn-primary") }}
        </div>

    </form>
</div>

<script>
// JavaScript to dynamically update the background description, selectable traits, and S.P.E.C.I.A.L stats
document.getElementById('origin_id').addEventListener('change', function() {
    // Get the selected background ID
    var originId = this.value;
    
    if (originId == -1) {
        document.getElementById('origin_description').innerText = '';
        document.getElementById('selectable_traits').innerHTML = '';
        document.getElementById('special_stats').innerHTML = '';
        return;
    }

    // Make an AJAX request to fetch the description, selectable traits, and S.P.E.C.I.A.L stats
    fetch('{{ url_for("get_origin_description") }}?origin_id=' + originId)
        .then(response => response.json())
        .then(data => {
            // Update the description paragraph
            document.getElementById('origin_description').innerText = data.description;

            // Update the selectable traits
            var traitsDiv = document.getElementById('selectable_traits');
            traitsDiv.innerHTML = ''; // Clear previous options

            data.selectable_traits.forEach(function(trait) {
                var div = document.createElement('div');
                div.className = 'form-check';

                var checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'form-check-input';
                checkbox.name = 'selectable_traits';
                checkbox.value = trait.id;
                checkbox.id = 'selectable_trait_' + trait.id;

                var label = document.createElement('label');
                label.className = 'form-check-label';
                label.htmlFor = 'selectable_trait_' + trait.id;
                label.innerText = trait.name;

                div.appendChild(checkbox);
                div.appendChild(label);

                traitsDiv.appendChild(div);
            });

            // Update the S.P.E.C.I.A.L stats
            var statsDiv = document.getElementById('special_stats');
            statsDiv.innerHTML = ''; // Clear previous stats

            data.special_stats.forEach(function(stat) {
                var div = document.createElement('div');
                div.className = 'form-group';

                var label = document.createElement('label');
                label.className = 'form-control-label';
                label.innerText = stat.name + ': ';

                var span = document.createElement('span');
                span.className = 'form-control-static';
                span.innerText = ' ' + stat.min + ' - ' + stat.max;

                div.appendChild(label);
                div.appendChild(span);

                statsDiv.appendChild(div);
            });
        });
});
</script>
{% endblock %}
